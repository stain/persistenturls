<idoc>
	<seq>
		<instr>
			<type>copy</type>
			<operand>this:param</operand>
			<target>var:purls</target>
		</instr>
		<instr>
			<type>copy</type>
			<operand><batch/></operand>
			<target>var:sqlBatch</target>
		</instr>		
		<while>
	    	<cond>
        	<instr>
          		<type>xpatheval</type>
          		<operand>var:purls</operand>
          		<operator>
            		<xpath>count(/purls/purl)&gt;= 1</xpath>
          		</operator>
          		<target>this:cond</target>
        	</instr>
      		</cond>
      		<seq>
      			<instr>
      				<type>stm</type>
      				<operand>var:sqlBatch</operand>
      				<operator>
      					<stm:group xmlns:stm="http://1060.org/stm">
							<stm:append xpath="/batch">
								<sql>update purls set "indexed" = true
									where "z_id" = <stm:param xpath="/purls/purl[1]/z_id/text()"/>;</sql>
      						</stm:append>
      					</stm:group>
      				</operator>
      				<param>var:purls</param>      		
      				<target>var:sqlBatch</target>
      			</instr>
      		        <instr>
          <type>stm</type>
          <operand>var:purls</operand>
          <operator>
            <stm:group xmlns:stm="http://1060.org/stm">
              <stm:delete xpath="/purls/purl[1]" />
            </stm:group>
          </operator>
          <target>var:purls</target>
        </instr>
      	</seq>
    	</while> 					
		<instr>
			<type>sqlBatch</type>
			<operand>var:sqlBatch</operand>
	      	<target>this:response</target>
		</instr>
	</seq>
</idoc>