@prefix xsd:<http://www.w3.org/2001/XMLSchema#>.
@prefix rdfs:<http://www.w3.org/2000/01/rdf-schema#>.
@prefix owl:<http://www.w3.org/2002/07/owl#>.
@prefix obj:<http://www.openrdf.org/rdf/2009/object#>.
@prefix http:<http://www.openrdf.org/rdf/2009/httpobject#>.
@prefix calli:<http://callimachusproject.org/rdf/2009/framework#>.
@prefix purl:<http://persistent.name/rdf/2010/purl#>.

purl:mirrored-domains rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom [owl:oneOf (calli:boot)]];
	rdfs:subClassOf [owl:onProperty obj:objectResponse;
		owl:allValuesFrom purl:Domain];
	obj:sparql """
		SELECT ?domain
		WHERE { { ?domain a purl:MirroredDomain }
		UNION { ?domain a purl:RemoteDomain } }
	""".

<#setUp-mirrors> owl:equivalentClass calli:started;
	obj:imports purl:RemoteGraph;
	obj:groovy """
		msg.proceed()
		def graphs = objectConnection.getObjects(RemoteGraph).asList()
		for (def domain : purlMirroredDomains()) {
			domain.purlRefreshGraphs()
		}
	""".

<#tearDown-mirrors> owl:equivalentClass calli:stopping;
	obj:imports purl:RemoteGraph;
	obj:groovy """
		def graphs = objectConnection.getObjects(RemoteGraph).asList()
		for (def domain : purlMirroredDomains()) {
			domain.purlStallGraphs()
		}
		msg.proceed()
	""".

purl:validating-domains rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom [owl:oneOf (calli:boot)]];
	rdfs:subClassOf [owl:onProperty obj:objectResponse;
		owl:allValuesFrom purl:Domain];
	obj:sparql """
		SELECT ?domain
		WHERE { ?domain purl:max-unresolved-days ?days }
	""".

<#setUp-validation> owl:equivalentClass calli:started;
	obj:imports purl:Domain;
	obj:groovy """
		msg.proceed()
		for (def domain : purlValidatingDomains()) {
			domain.startResolving()
		}
	""".

<#tearDown-validation> owl:equivalentClass calli:stopping;
	obj:imports purl:Domain;
	obj:groovy """
		for (def domain : purlValidatingDomains()) {
			domain.stopResolving()
		}
		msg.proceed()
	""".
